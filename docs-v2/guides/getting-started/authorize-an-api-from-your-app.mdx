---
title: 'Authorize users from your app'
sidebarTitle: 'Authorize users from your app'
description: 'Step-by-step guide to getting user authorization to access an external API from your application.'
---

<Info>
Pre-requisite: complete the [_Configure an integration_ guide](/guides/getting-started/configure-an-integration).
</Info>

# Generate a session token (backend)

In **your backend**, set up an API endpoint that your frontend will call. This endpoint should request a session token from Nango and return it to the frontend.

Here's an example of how to generate a session token using Nango's API ([API ref](/reference/api/connect/sessions/create) / [SDK ref](/reference/sdks/node#create-a-connect-session)):

<Tabs>

<Tab title="cURL">

```bash
curl --request POST \
  --url https://api.nango.dev/connect/sessions \
  --header 'Authorization: Bearer <NANGO-SECRET-KEY>' \
  --header 'Content-Type: application/json' \
  --data '{
    "end_user": {
      "id": "<END-USER-ID>",
      "email": "<END-USER-EMAIL>",
      "display_name": "<OPTIONAL-END-USER-DISPLAY-NAME>"
    },
    "organization": {
      "id": "<OPTIONAL-ORG-ID>",
      "display_name": "<OPTIONAL-ORG-DISPLAY-NAME>"
    },
    "allowed_integrations": [
      "<INTEGRATION-ID>"
    ]
  }'

```

</Tab>

<Tab title="Node">

```ts
import { Nango } from '@nangohq/node';

const nango = new Nango({ secretKey: process.env['<NANGO-SECRET-KEY>'] });

api.post('/sessionToken', (req, res) => {
  // Ask Nango for a secure token
  const res = await nango.createConnectSession({
    end_user: {
      id: '<END-USER-ID>',
      email: '<END-USER-EMAIL>',
      display_name: '<OPTIONAL-END-USER-DISPLAY-NAME>',
    },
    organization: {
      id: '<OPTIONAL-ORG-ID>',
      display_name: '<OPTIONAL-ORG-DISPLAY-NAME>'
    },
    allowed_integrations: ['<INTEGRATION-ID>'],
  });

  // Send this token back to your frontend
  res.status(200).send({
    sessionToken: res.data.token
  });
});
```
</Tab>

</Tabs>

<Accordion title="Clarifying end user and organization information">
  The `end_user` and `organization` information are primarily used for display purposes in the Nango UI and, in some cases, for custom billing plans. These fields help identify which connection belongs to which end user and/or organization.

  Required fields:
  - `end_user.id`: Your internal ID of the user who initiated the authorization flow.
  - `end_user.email`: The email of the user who initiated the authorization flow.

  While some connections may belong to an organization rather than a specific user, in most cases, a user initiates the authorization flow. In such scenarios:
  - You should store the user’s ID and email along with the relevant organization details. Sometimes, the user email in your app will not match the email they use to connect their external account, which is fine. 
  - If you don’t have a user ID or email, you can use placeholders. This won’t affect how Nango operates.

  <Info>
    The user’s email is used in the Nango UI to retrieve & display their company’s logo, improving visual clarity.
  </Info>
</Accordion>

## Trigger the auth flow (frontend)

In **your frontend**, load the Nango frontend SDK, retrieve the session token from the backend, and trigger the authorization flow. 

### Option 1: Use the Nango Connect UI

```js
import Nango from '@nangohq/frontend';

const nango = new Nango();
const connect = nango.openConnectUI({ 
  onEvent: (event) => {
    if (event.type === 'close') {
      // Handle modal closed.
    } else if (event.type === 'connect') {
      // Handle auth flow successful.
    }
  },
});

const res = await fetch('/sessionToken', { method: 'POST' }); // Retrieve the session roken from your backend.
connect.setSessionToken(res.sessionToken); // A loading indicator is shown until this is set.
```

### Option 2: Use your custom UI

Refer to the [_Authorize an API from your app with custom UI_ guide](/guides/authorize-an-api-from-your-app-with-custom-ui) for details on implementing a custom user interface.

## Save the Connection ID (backend)

Your backend will receive a notification from Nango when an authorization attempt is completed.

To set this up:
1. go to the _Environment Settings_ tab in the Nango UI
2. specify a _Webhook URL_ where Nango should send notifications
3. enable the _Send New Connection Creation Webhooks_ option
4. create the specified route in your backend to handle Nango webhooks

Nango webhooks are post requests with the following JSON body:
```json
{
    "type": "auth",
    "connectionId": "<CONNECTION-ID>",
    "authMode": "OAUTH1|OAUTH2|OAUTH2_CC|BASIC|API_KEY|APP_STORE|CUSTOM|APP|NONE|TBA",
    "providerConfigKey": "<INTEGRATION-ID>",
    "provider": "<API-CONFIGURATION-ID>",
    "environment": "dev" | "prod",
    "success": true | false,
    "operation": "creation" | "override" | "unknown",
    "error": "<ERROR>"
}
```

For each successful authorization attempt, persist the connection ID. This ID is required to retrieve connection credentials later.

# Troubleshoot authorization errors

If an authorization request fails, you can analyze the relevant log in the _Logs_ tab of the Nango UI.

# You are ready

You have successfully set up the authorization flow for your users. Next steps: 
- View new connections in the _Connections_ tab of the Nango UI
- Retrieve connection credentials with the [API](/reference/api/connection/get) or [SDK](/reference/sdks/node#get-a-connection-with-credentials)
- [Read data](/guides/getting-started/read-from-an-api) from the API
- [Write data](/guides/getting-started/write-to-an-api) to the API
- [Proxy request](/guides/getting-started/proxy-requests-to-an-api) to the API

<Tip>
**Questions, problems, feedback?** Please reach out in the [Slack community](https://nango.dev/slack).
</Tip>
