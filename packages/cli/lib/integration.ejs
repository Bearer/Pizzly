import { NangoSync } from '@nangohq/node';
import { Issue } from './models';

export default async function fetchData(nango: NangoSync): Promise<{issues: Issue[]}> {
    /**
     * Rest of the integration code goes below.
     * Example:
     */
    const response = await nango.get({
        endpoint: 'repos/NangoHQ/nango/issues'
    });

    const issues = response.data.map((ghIssue: any) => {
        const issue: Issue = {
            id: ghIssue.id,
            title: ghIssue.title,
            description: ghIssue.body,
            status: ghIssue.status,
            author: {
                avatar_url: ghIssue.user.avatar_url,
            }
        };

        return issue;
    });

    return { issues };
}
